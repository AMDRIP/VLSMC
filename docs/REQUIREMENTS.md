# RAND Elecorner 36 — Требования к ОС (Bare-Metal)

> ОС работает на реальном x86 оборудовании (или эмуляторах QEMU/Bochs/VirtualBox), а не как симулятор поверх хостовой ОС.

---

## Стек технологий

| Компонент | Технология |
|-----------|-----------|
| Ядро ОС | C++17 (Freestanding / Newlib) |
| Загрузчик | NASM (16-bit Real Mode -> 32-bit Protected Mode) |
| Вывод на экран | VGA Text Mode (прямая запись в `0xB8000`) |
| Ввод | PS/2 Контроллер Клавиатуры (INB/OUTB `0x60`) |
| Сборка | x86_64-elf-g++ (Cross-compiler) + Make/CMake |
| Эмулятор | QEMU (`qemu-system-i386`) |

---

## 1. Загрузка и Инициализация (Bootloader)

### Функциональные требования
- **BOOT-01** — Загрузчик состоит из 1 сектора (512 байт, `bootloader.asm`), форматируется как FAT16.
- **BOOT-02** — Загрузчик читает `KERNEL.BIN` из корневого каталога (Root Directory) с помощью прерываний BIOS (`int 0x13`).
- **BOOT-03** — Точка входа ядра (`kernel_entry.asm`) переводит процессор в 32-битный Protected Mode.
- **BOOT-04** — Точка входа настраивает базовый GDT (Global Descriptor Table).
- **BOOT-05** — Точка входа вызывает глобальные конструкторы C++ (секция `.init_array`), после чего передает управление в `kernel_main()`.

---

## 2. Ядро и Базовое окружение (Kernel Core)

### Функциональные требования
- **KRN-01** — Ядро компилируется без стандартной библиотеки ОС (`-ffreestanding`, `-nostdlib`).
- **KRN-02** — Ядро реализует собственные функции Malloc/Free либо портирует Newlib/picolibc для обеспечения работы `std::vector`, `std::string` и оператора `new`.
- **KRN-03** — Ядро инициализирует IDT (Interrupt Descriptor Table) для обработки аппаратных прерываний и исключений процессора (Page Fault, General Protection Fault).
- **KRN-04** — Реализована функция-заглушка `__cxa_pure_virtual` и прочие необходимые хаки для поддержки виртуальных функций C++.

---

## 3. Управление Памятью (Memory)

### Функциональные требования
- **MEM-01** — Аллокатор Физической Памяти (Physical Memory Manager): управляет свободными фреймами оперативной памяти (например, через Bitmap).
- **MEM-02** — Ядро может получать карту доступной памяти от BIOS (через `int 0x15, EAX=0xE820`) на этапе загрузки или от GRUB/Multiboot (при наличии).
- **MEM-03** — Heap Allocator: Реализация алгоритма типа First-Fit или Slab для кучи ядра (чтобы работал `kmalloc` и оператор `new`).
- **MEM-04** — Страничная организация: включение Paging и создание таблиц страниц (Page Directory, Page Table).

---

## 4. Ввод и Вывод (I/O Drivers)

### Функциональные требования
- **IO-01** — **VGA Драйвер**: Прямой доступ к физической памяти терминала `0xB8000`. Поддержка вывода символов, прокрутки экрана (scrolling), смены цветов текста/фона.
- **IO-02** — **Keyboard Драйвер**: Взаимодействие с портом `0x60` (PS/2). Чтение скан-кодов через аппаратные прерывания (IRQ1). Преобразование скан-кодов в ASCII-символы.
- **IO-03** — **Timer**: Настройка PIT (Programmable Interval Timer) на генерацию прерываний таймера (IRQ0) для работы планировщика.

---

## 5. Управление Процессами и Многозадачность (В перспективе)

### Растущие требования
- **PROC-01** — Программная многозадачность: сохранение и восстановление контекста регистров процессора (EAX, EBX, ESP, EIP) при переключениях от таймера PIT.
- **PROC-02** — Системные вызовы (Syscalls): переход от `int 0x80` из Ring 3 в Ring 0.
- **PROC-03** — Изоляция процессов через Ring 3 (User Space).

---

## 6. Общие Нефункциональные Требования

| Код | Требование |
|-----|-----------|
| **NFR-01** | Весь разрабатываемый интерфейс (в консоли) и логи ядра на **русском языке** |
| **NFR-02** | Полноценная поддержка классов и шаблонов C++ в ядре |
| **NFR-03** | Строгая модульность драйверов |
| **NFR-04** | Отсутствие "Segmentation fault" в Linux — ядро ОС падает в **Kernel Panic** |
| **NFR-05** | Сборка с помощью кросс-компилятора и Make автоматизирована |
