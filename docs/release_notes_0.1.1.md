# üöÄ VLSMC v0.1.1 ‚Äî Stability & Filesystem Patch

> **RAND Elecorner 36** ‚Äî 28.02.2026

–ü–∞—Ç—á-—Ä–µ–ª–∏–∑, —É—Å—Ç—Ä–∞–Ω—è—é—â–∏–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ—Ñ–µ–∫—Ç—ã —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —è–¥—Ä–∞ –∏ —É–ª—É—á—à–∞—é—â–∏–π —Ñ–∞–π–ª–æ–≤—É—é –ø–æ–¥—Å–∏—Å—Ç–µ–º—É.

---

## üîß –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### Deadlock –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞ **race condition** –≤ `EventSystem::wait`: –º–µ–∂–¥—É —Å–Ω—è—Ç–∏–µ–º `InterruptGuard` –∏ –≤—ã–∑–æ–≤–æ–º `block_current()` –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–æ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –º–æ–≥–ª–æ –æ—á–∏—Å—Ç–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞—é—â–∏—Ö –ø–æ—Ç–æ–∫–æ–≤, –ø–æ—Å–ª–µ —á–µ–≥–æ –ø–æ—Ç–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è. 

**–†–µ—à–µ–Ω–∏–µ:** `KeyboardDriver::get_char()` –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ –∞—Ç–æ–º–∞—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω x86 `sti; hlt; cli`, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∏–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–∫–Ω–∞ –≥–æ–Ω–∫–∏ –±–ª–∞–≥–æ–¥–∞—Ä—è –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–º—É —Å–≤–æ–π—Å—Ç–≤—É –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (–∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –Ω–∞ –æ–¥–Ω—É –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ—Å–ª–µ `sti`).

### Deadlock –≤ idle-–ø–æ—Ç–æ–∫–µ
–¶–∏–∫–ª –æ–∂–∏–¥–∞–Ω–∏—è –≤ `kernel_main` –≤—ã–ø–æ–ª–Ω—è–ª `hlt` –±–µ–∑ `sti`, —á—Ç–æ –ø—Ä–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ `IF=0` –æ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ **–≤–µ—á–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–µ CPU** ‚Äî –Ω–∏ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –Ω–µ –º–æ–≥ –±—ã—Ç—å —Ä–∞–∑–±—É–∂–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:** `hlt` –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ `sti; hlt`.

---

## üíæ –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞

### –ê—Ç—Ä–∏–±—É—Ç—ã —Ñ–∞–π–ª–æ–≤
- –ù–æ–≤—ã–µ FAT16-–∞—Ç—Ä–∏–±—É—Ç—ã: **`-gd`** (–∑–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è) –∏ **`-gc`** (–∑–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è)
- –ö–æ–º–∞–Ω–¥–∞ **`chattr`** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏: `chattr +gd FILE.TXT`, `chattr -gc FILE.TXT`
- –ö–æ–º–∞–Ω–¥–∞ `ls` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã –≤ –∫–æ–ª–æ–Ω–∫–µ `Attr`
- –ö–æ–º–∞–Ω–¥—ã `rm` –∏ `write` —É–≤–∞–∂–∞—é—Ç —Ñ–ª–∞–≥–∏ –∑–∞—â–∏—Ç—ã

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è FAT16
- **`rm`** –±–æ–ª—å—à–µ –Ω–µ —É–¥–∞–ª—è–µ—Ç –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Å–∫–∞ ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π, —É–¥–∞–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
- **`fat16_rename`** ‚Äî —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ—Ä—á–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–ø–∏—è —á–µ—Ä–µ–∑ —Å—Ç–µ–∫)
- **`vfs_rename`** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ parent-vnode –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏)

---

## üñ•Ô∏è –£–ª—É—á—à–µ–Ω–∏—è —à–µ–ª–ª–∞

### –ö–æ–º–∞–Ω–¥–∞ `ls`
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ `<DIR>` –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –≤ –±–∞–π—Ç–∞—Ö
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è **–≤ –Ω–∞—á–∞–ª–µ —Å–ø–∏—Å–∫–∞**, –ø–µ—Ä–µ–¥ —Ñ–∞–π–ª–∞–º–∏
- –ê—Ç—Ä–∏–±—É—Ç—ã `[D]`, `[R]`, `[H]`, `[-gc]`, `[-gd]` –≤—ã–≤–æ–¥—è—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥
- `printf` ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —à–∏—Ä–∏–Ω—ã (`%8d`, `%-13s`) –≤ —è–¥—Ä–µ –∏ libc

---

## üìä –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `kernel_main.cpp` | `hlt` ‚Üí `sti; hlt` –≤ idle-—Ü–∏–∫–ª–µ |
| `keyboard.cpp` | `EventSystem::wait` ‚Üí –∞—Ç–æ–º–∞—Ä–Ω—ã–π `sti; hlt; cli` |
| `fat16.cpp` | –ê—Ç—Ä–∏–±—É—Ç—ã `-gd`/`-gc`, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `fat16_rename`, —Ñ–∏–∫—Å `rm` |
| `vfs.cpp` | –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π `vnode_release` –≤ `vfs_rename` |
| `shell.cpp` | `ls` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–≤–µ—Ä—Ö—É + `<DIR>`, `chattr`, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| `libc.cpp` | –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —à–∏—Ä–∏–Ω—ã –≤ `printf` |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

```bash
./build.sh
qemu-system-i386 -fda disk.img -hda data.img -boot a
```

**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞**: x86 (IA-32) | **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: NASM, GCC (cross-compiler), QEMU
