# RAND Elecorner 36 — Стек Технологий

> Build 0001 (Bare-Metal OS)

---

## Обзор

RAND Elecorner 36 — это собственная 32-битная операционная система архитектуры x86, написанная с нуля и работающая на реальном оборудовании (bare-metal) или в эмуляторах аппаратуры (QEMU, Bochs, VirtualBox). Система полностью самодостаточна (freestanding) и не использует сторонние высокоуровневые операционные системы или библиотеки в процессе работы.

---

## Основные технологии

### C++17 — Ядро ОС (Kernel)

Вся логика ядра операционной системы реализована на современном стандарте C++. Ядро компилируется без привязки к стандартной библиотеке хоста (`-ffreestanding`, `-nostdlib`).

| Параметр | Значение |
|----------|---------|
| **Стандарт** | C++17 |
| **Компилятор** | Кросс-компилятор `i686-elf-g++` или `x86_64-linux-gnu-g++` |
| **Роль** | Планировщик потоков, менеджер физической/виртуальной памяти, файловая система FAT, IPC, аппаратные драйверы (VGA, Keyboard, PCI) |
| **Библиотека С** | Собственная реализация (или легковесные порты вроде Newlib/picolibc) в виде `libc.cpp` |

### Assembly (NASM) — Загрузчик и Низкоуровневые операции

Ассемблер x86 используется там, где C++ бессилен: для загрузчика (с кодом BIOS прерываний) и для архитектурно-зависимого кода ядра.

| Параметр | Значение |
|----------|---------|
| **Ассемблер** | NASM |
| **Загрузчик (Bootloader)** | 16-bit Real Mode (Stage 1 и Stage 2), чтение FAT, переход в 32-bit Protected Mode |
| **Ядро (Kernel ASM)** | 32-bit Protected Mode, обработчики прерываний (ISR/IRQ в IDT), переключение контекста задач (Context Switch), системные вызовы (Syscalls) |
| **Синтаксис** | Intel Syntax |

### C++ и С — Пользовательские программы (User Space, Ring 3)

Программы для ОС пишутся на C++ (или C) и компилируются в стандартные 32-битные ELF бинарники, которые загружаются ядром и исполняются в изолированном адресном пространстве пользователя (Ring 3).

| Параметр | Значение |
|----------|---------|
| **Формат бинарников** | ELF (Executable and Linkable Format), 32-bit |
| **Библиотека** | `user_crt0` (инициализация Ring 3) и `libc` (обёртки для системных вызовов через `sysenter` / `int 0x80`) |
| **Компиляция** | Аналогично ядру (кросс-компилятор), линковка с собственными скриптами компоновщика |

---

## Система сборки

Сборка всей операционной системы (загрузчики, ядро, полезные утилиты пространства пользователя) автоматизирована с помощью Bash сценариев и Makefile / CMake.

| Инструмент | Для чего используется |
|-----------|---------|
| **Bash (`build.sh`)** | Главный скрипт сборки. Вызывает компиляторы, собирает всё воедино и формирует загрузочные образы. |
| **mtools (`mformat`, `mcopy`)** | Создание и манипуляция образами гибких дисков FAT12 без необходимости root-прав. |
| **dosfstools (`mkfs.fat`)** | Форматирование образов жесткого диска в FAT16. |
| **dd** | Побитовое копирование загрузочного сектора (Boot Sector) на образы дисков. |

### Типичные команды

Процесс сборки и запуска полностью инкапсулирован:

```bash
# Сборка загрузчика, ядра, пользовательских программ и создание образов disk.img и data.img
./build.sh

# Запуск скомпилированной ОС в графическом эмуляторе QEMU
qemu-system-i386 -fda disk.img -hda data.img -boot a
```

---

## Архитектурные Особенности

| Компонент | Текущая реализация |
|-----------|--------------------|
| **Архитектура Процессора** | x86 (IA-32) |
| **Режим выполнения** | Protected Mode (32-bit) |
| **Память** | Paging включён (виртуальная память, изоляция адресных пространств) |
| **Многозадачность** | Вытесняющая (Preemptive) на базе аппаратного таймера PIT (Round Robin Scheduler) и потоки (Threads) |
| **Драйверы** | Монолитные (находятся в Ring 0): VGA (текстовый/графический режимы), PS/2 Клавиатура, ATA (диск), PCI |
| **Поддержка файлов** | Чтение файловых систем FAT12, FAT16 |
| **Межпроцессное Взаимодействие (IPC)** | Синхронные/Асинхронные сообщения, блокирующий IPC, Event Channels |

---

## Структура Проекта на Диске

```
VLSMC/
├── build.sh
├── README.md
│
├── boot/                     # Ассемблерный код загрузчика (16-bit)
│   ├── bootloader.asm        # Stage 1 (Boot Sector, 512 bytes)
│   └── stage2.asm            # Stage 2 (A20, Memory Map, загрузка ядра)
│
├── kernel/                   # Исходный код Ядра (C++ / ASM, 32-bit, Ring 0)
│   ├── include/kernel/       # Заголовочные файлы подсистем
│       ├── pmm.h, vmm.h      # Менеджеры памяти
│       ├── task_scheduler.h  # Многозадачность
│       ├── pci.h             # Работа с шиной PCI
│       ├── vga.h, keyboard.h # Драйверы
│   ├── src/                  # Исходники
│   │   ├── kernel_entry.asm  # Точка входа ядра (настройка GDT)
│   │   ├── kernel_main.cpp   # Основная функция инициализации ОС
│   │   ├── ...               # Реализации подсистем ядра
│   └── linker.ld             # Скрипт компоновщика для KERNEL.BIN
│
├── user/                     # Программы Пользовательского Пространства (C++, Ring 3)
│   ├── src/                  # Исходники программ, транслируемых в ELF
│   │   ├── user_hello.cpp    # Тестовая программа "Привет мир"
│   │   ├── user_fs_driver.cpp# (В разработке) Внешний драйвер ФС
│   │   ├── ...
│   └── lib/                  # Библиотеки для пользовательских программ (libc wrappers)
│
└── docs/                     # Архитектурная документация проекта
    ├── ARCHITECTURE.md
    ├── PROJECT_PLAN.md
    ├── REQUIREMENTS.md
    └── ...
```
