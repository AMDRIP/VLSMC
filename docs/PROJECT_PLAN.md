# RAND Elecorner 36 ‚Äî –ü–ª–∞–Ω –ü—Ä–æ–µ–∫—Ç–∞

> **–†–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–∞ –∏ Roadmap —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Bare-Metal –û–°**
> Build 0001 (x86 32-bit Protected Mode)

---

## –û –ø—Ä–æ–µ–∫—Ç–µ

**RAND Elecorner 36** ‚Äî 32-–±–∏—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –Ω–∞–ø–∏—Å–∞–Ω–Ω–∞—è —Å –Ω—É–ª—è. –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–≥–æ Qt-—Å–∏–º—É–ª—è—Ç–æ—Ä–∞ –∫ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

### –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π (–ö–æ—Ä–æ—Ç–∫–æ)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|-----------|
| –ó–∞–≥—Ä—É–∑—á–∏–∫ | **NASM** (16-bit to 32-bit) |
| –Ø–¥—Ä–æ –û–° | **C++17** (Freestanding, no STL) |
| –°–±–æ—Ä–∫–∞ | **GCC (Cross-Compiler)**, **mtools**, **Bash** |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | **QEMU** PC Emulator |

> –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [TECH_STACK.md](TECH_STACK.md)

---

## –≠—Ç–∞–ø 1 ‚Äî Bootstrap –∏ –ë–∞–∑–æ–≤–æ–µ –Ø–¥—Ä–æ

| –°—Ç–∞—Ç—É—Å | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|--------|----------|
| ‚úÖ | 1.1 First Stage Bootloader | –ß—Ç–µ–Ω–∏–µ FAT12 —Å –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–π –¥–∏—Å–∫–µ—Ç—ã (–°–µ–∫—Ç–æ—Ä 0, `bootloader.asm`). |
| ‚úÖ | 1.2 Second Stage Bootloader | –í–∫–ª—é—á–µ–Ω–∏–µ –ª–∏–Ω–∏–∏ A20, –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –ø–∞–º—è—Ç–∏ (E820), –ø–∞—Ä—Å–∏–Ω–≥ FAT, –∑–∞–≥—Ä—É–∑–∫–∞ `KERNEL.BIN` (`stage2.asm`). |
| ‚úÖ | 1.3 –ü–µ—Ä–µ—Ö–æ–¥ –≤ Protected Mode | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π GDT (Global Descriptor Table) –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ 32-–±–∏—Ç–Ω—ã–π —Ä–µ–∂–∏–º. |
| ‚úÖ | 1.4 –°++ Kernel Entry | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–µ–∫–∞ —è–¥—Ä–∞, –≤—ã–∑–æ–≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö `_init()` –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤, –ø–µ—Ä–µ–¥–∞—á–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ `kernel_main`. |
| ‚úÖ | 1.5 –ë–∞–∑–æ–≤—ã–π –≤—ã–≤–æ–¥ (VGA) | –ü—Ä—è–º–∞—è –∑–∞–ø–∏—Å—å —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ –∞–¥—Ä–µ—Å—É `0xB8000` (VGA Text Mode Driver). |
| ‚úÖ | 1.6 –ì–ª–æ–±–∞–ª—å–Ω–∞—è GDT/IDT | –¢–∞–±–ª–∏—Ü–∞ –≤–µ–∫—Ç–æ—Ä–æ–≤ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (Page Fault, General Protection Fault ‚Äî Kernel Panic). |

---

## –≠—Ç–∞–ø 2 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–∞–º—è—Ç—å—é (Memory Subsystem)

| –°—Ç–∞—Ç—É—Å | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|--------|----------|
| ‚úÖ | 2.1 PMM (Physical Memory) | –ú–µ–Ω–µ–¥–∂–µ—Ä —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ Bitmap. –£—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–∞—à–∏–Ω–Ω–∞—Ö —Ñ—Ä–µ–π–º–æ–≤ (–ø–æ 4–ö–±). |
| ‚úÖ | 2.2 VMM (Virtual Memory / Paging) | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–π –∞–¥—Ä–µ—Å–∞—Ü–∏–∏. Page Directory, Page Tables. –ú–∞–ø–ø–∏–Ω–≥ —è–¥—Ä–∞ –∏ –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏. |
| ‚úÖ | 2.3 Heap Allocator (kmalloc) | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—É—á–∏ —è–¥—Ä–∞ (First-Fit/Slab) –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `new` –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å–ø–∏—Å–∫–æ–≤ (–≤–µ–∫—Ç–æ—Ä–æ–≤). |
| ‚úÖ | 2.4 C++ Runtime / libc | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥–ª—É—à–µ–∫ –¥–ª—è `<string>`, `<vector>` (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ—Ä—Ç libc), `__cxa_pure_virtual`. |

---

## –≠—Ç–∞–ø 3 ‚Äî Interrupts & Hardware Abstraction (HAL)

| –°—Ç–∞—Ç—É—Å | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|--------|----------|
| ‚úÖ | 3.1 –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π (PIC)| –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ IRQ (0-15) –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞. |
| ‚úÖ | 3.2 –¢–∞–π–º–µ—Ä (PIT) | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç–∏–∫–∞ –Ω–∞ IRQ0 –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞. |
| ‚úÖ | 3.3 –î—Ä–∞–π–≤–µ—Ä –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `IRQ1` –Ω–∞ –ø–æ—Ä—Ç—É `0x60`, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Scan Code –≤ ASCII. |
| ‚úÖ | 3.4 RTC (Real Time Clock) | –ß—Ç–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ CMOS. |
| ‚úÖ | 3.5 PCI Bus Scanning | –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∏–Ω—ã PCI –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (`class_id`, `vendor_id`). |

---

## –≠—Ç–∞–ø 4 ‚Äî –ú–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å –∏ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

| –°—Ç–∞—Ç—É—Å | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|--------|----------|
| ‚úÖ | 4.1 –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö | `TCB` (Thread Control Block) / `PCB` (Process Control Block). |
| ‚úÖ | 4.2 –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | –ê—Å—Å–µ–º–±–ª–µ—Ä–Ω—ã–π –º–∞–∫—Ä–æ—Å `switch_task` (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ EAX..EDI, EBP, ESP –Ω–∞ —Å—Ç–µ–∫). |
| ‚úÖ | 4.3 Kernel Threads | –ú–µ—Ö–∞–Ω–∏–∑–º —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –≤ Ring 0. |
| ‚úÖ | 4.4 Round Robin Scheduler | –í—ã—Ç–µ—Å–Ω—è—é—â–∞—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å –ø–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—é —Ç–∞–π–º–µ—Ä–∞. |

---

## –≠—Ç–∞–ø 5 ‚Äî –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ (Ring 3)

| –°—Ç–∞—Ç—É—Å | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|--------|----------|
| ‚úÖ | 5.1 TSS (Task State Segment) | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TSS –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ Ring 3 –≤ Ring 0 (—É–∫–∞–∑–∞—Ç–µ–ª—å `esp0` –Ω–∞ —Å—Ç—ç–∫ —è–¥—Ä–∞). |
| ‚úÖ | 5.2 –ó–∞–≥—Ä—É–∑—á–∏–∫ —Ñ–æ—Ä–º–∞—Ç–æ–≤ ELF | –ü–∞—Ä—Å–∏–Ω–≥ 32-–±–∏—Ç–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ (–°–µ–∫—Ü–∏–∏ `.text`, `.data`, `.bss`). |
| ‚úÖ | 5.3 –ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ | –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π `Page Directory` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Ring 3 –Ω–µ –≤–∏–¥–∏—Ç –ø–∞–º—è—Ç—å —è–¥—Ä–∞). |
| ‚úÖ | 5.4 Syscall Gate (`int 0x80`)| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤. –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä—ã (`eax`, `ebx`, `ecx`). |
| ‚úÖ | 5.5 `user_crt0.o` / `libc`  | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (Ring 3). |

---

## –≠—Ç–∞–ø 6 ‚Äî –ú–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–µ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ (IPC)

| –°—Ç–∞—Ç—É—Å | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|--------|----------|
| ‚úÖ | 6.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–º–µ–Ω–∞ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –¥–ª—è –±—É–¥—É—â–µ–π –º–∏–∫—Ä–æ—è–¥–µ—Ä–Ω–æ–π –º–æ–¥–µ–ª–∏ –≤–Ω–µ—à–Ω–∏—Ö –¥—Ä–∞–π–≤–µ—Ä–æ–≤. |
| ‚úÖ | 6.2 –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ/–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ | –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `send_message` –∏ `receive_message`. |
| ‚úÖ | 6.3 Blocking IPC (Wait/Wake)| –ü–µ—Ä–µ–≤–æ–¥ –ø–æ—Ç–æ–∫–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "Wait" –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. –ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö (Event Channels). |

---

## –≠—Ç–∞–ø 7 ‚Äî –§–∞–π–ª–æ–≤—ã–µ –°–∏—Å—Ç–µ–º—ã (File System VFS)

| –°—Ç–∞—Ç—É—Å | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|--------|----------|
| ‚úÖ | 7.1 ATA (IDE)PIO –î—Ä–∞–π–≤–µ—Ä | –ë–∞–∑–æ–≤—ã–π –¥—Ä–∞–π–≤–µ—Ä –ø—Ä—è–º–æ–≥–æ —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ —Å–µ–∫—Ç–æ—Ä–æ–≤ –¥–∏—Å–∫–∞ (`user` –¥—Ä–∞–π–≤–µ—Ä –∏–ª–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π). |
| ‚úÖ | 7.2 –ü–∞—Ä—Å–µ—Ä FAT16 | –ß—Ç–µ–Ω–∏–µ –§–°, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Ñ–∞–π–ª–æ–≤ —Å –æ–±—Ä–∞–∑–∞ `data.img`. |
| üöß | 7.3 –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è VFS | –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Virtual File System) ‚Äî `open()`, `read()`, `write()`, `close()`. |
| üöß | 7.4 –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–ø–∏—Å–∏ –§–° | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü FAT –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (Writing to disk). |

---

## –≠—Ç–∞–ø 8 ‚Äî Shell / –¢–µ—Ä–º–∏–Ω–∞–ª –û–°

| –°—Ç–∞—Ç—É—Å | –ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|--------|----------|
| ‚úÖ | 8.1 –ú–æ–¥—É–ª—å Shell | –†–∞–∑–±–æ—Ä –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫. |
| ‚úÖ | 8.2 –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã | `help`, `clear`, `ls`, `cat`, `ps`, `mem`, `time`, `pci`. |
| ‚úÖ | 8.3 –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π | –ö–æ–º–∞–Ω–¥–∞ `run <filename.elf>` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å –¥–∏—Å–∫–∞ –≤ Ring 3. |
| üöß | 8.4 Redirection (I/O) | –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ (`>` –∏ `>>`). |

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–∑–≤–∏—Ç–∏—è –¥–∞–ª—å—à–µ

1. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ VFS (–ó–∞–ø–∏—Å—å –Ω–∞ –¥–∏—Å–∫, —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π).
2. –í—ã–Ω–æ—Å –¥—Ä–∞–π–≤–µ—Ä–æ–≤ (ATA, Keyboard) –≤ Ring 3 –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –º–∏–∫—Ä–æ—è–¥–µ—Ä–Ω—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ (—á–µ—Ä–µ–∑ Blocking IPC –∏ Memory Mapped I/O).
3. –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ –û–° (VGA `Mode 13h` –∏–ª–∏ VESA). –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –æ–∫–æ—à–µ–∫ –ø–æ–≤–µ—Ä—Ö Video RAM.
4. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ UI –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–∫–Ω–æ–ø–æ—á–∫–∏, —à—Ä–∏—Ñ—Ç—ã).
